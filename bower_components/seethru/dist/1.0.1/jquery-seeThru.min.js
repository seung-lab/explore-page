/*! jQuery-seeThru 1.0.1 04-10-2013 see https://github.com/m90/jquery-seeThru for details*/
(function(e){function t(t,a){var i=e("<canvas/>").attr({width:t.width,height:t.height}).get(0).getContext("2d");i.drawImage(a,0,0,t.width,t.height);for(var h=i.getImageData(0,0,t.width,t.height),n=3,r=h.data.length;r>n;n+=4)h.data[n-1]=h.data[n-2]=h.data[n-3]=h.data[n],h.data[n]=255;return h}function a(e,t){for(var a=3,i=e.data.length;i>a;a+=4)e.data[a]=t[a-1],e.data[a-3]=e.data[a-3]/(t[a-1]?t[a-1]/255:1),e.data[a-2]=e.data[a-2]/(t[a-1]?t[a-1]/255:1),e.data[a-1]=e.data[a-1]/(t[a-1]?t[a-1]/255:1)}var i={init:function(i){i||(i={});var h=e.extend({start:"autoplay",end:"loop",mask:"",alphaMask:!1,width:"",height:"",poster:!1,unmult:!1,shimRAF:!0},i);return h.shimRAF&&!window.requestAnimationFrame&&function(){for(var e=0,t=["ms","moz","webkit","o"],a=0;t.length>a&&!window.requestAnimationFrame;++a)window.requestAnimationFrame=window[t[a]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[a]+"CancelAnimationFrame"]||window[t[a]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var a=(new Date).getTime(),i=Math.max(0,16-(a-e)),h=window.setTimeout(function(){t(a+i)},i);return e=a+i,h}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),this.each(function(){e(this).data("seeThru")&&e.error("seeThru already initialized on selected element");var i,n=!1,r=h.alphaMask===!0;e(h.mask).length&&(i=e(h.mask)[0],"IMG"===i.tagName?(e(i).hide(),n=!0):e.error("Mask element must be <img>")),"VIDEO"===this.tagName?(e(this).on("loadedmetadata.seeThru",function(){function o(e){w.drawImage(d,0,0,m.width,m.height*u);var t=w.getImageData(0,0,m.width,m.height),i=w.getImageData(0,m.height,m.width,m.height).data;h.unmult&&a(t,i);for(var n=3,r=t.data.length;r>n;n+=4)t.data[n]=h.alphaMask?i[n-1]:Math.max(i[n-1],i[n-2],i[n-3]);g.putImageData(t,0,0,0,0,m.width,m.height),e&&(p=requestAnimationFrame(function(){o(!0)}),s.data("seeThru").interval=p)}var s=e(this),d=this,u=(e(window),n?1:2),m={width:parseInt(h.width,10),height:parseInt(h.height,10)};m.height&&m.width||(s.attr("width")||s.attr("height")?s.attr("height")?s.attr("width")?(m.width=m.width||parseInt(d.width,10),m.height=m.height||parseInt(d.height,10)/u):(m.width=m.width||parseInt(d.height,10)*(d.videoWidth/Math.floor(d.videoHeight/u)),m.height=m.height||parseInt(d.height,10)):(m.width=m.width||parseInt(d.width,10),m.height=m.height||parseInt(d.width,10)/(d.videoWidth/Math.floor(d.videoHeight/u))):(m.width=m.width||d.videoWidth,m.height=m.height||d.videoHeight/u));var l=e("<canvas/>",{"class":"seeThru-buffer"}).attr({width:m.width,height:2*m.height}).hide(),c=e("<canvas/>",{"class":"seeThru-display"}).attr({width:m.width,height:m.height}),g=c[0].getContext("2d"),w=l[0].getContext("2d");n&&(i.width=m.width,i.height=m.height,r?w.putImageData(t(m,i),0,m.height):w.drawImage(i,0,m.height,m.width,m.height)),"stop"===h.end&&d.loop&&(d.loop=!1);var p;h.poster&&s.wrap(e("<div>").css({position:"relative",width:m.width+"px",height:m.height+"px"}).addClass("seeThru-container")),s.hide().data("seeThru",{staticMask:n,alphaMask:r,interval:p}).after(l,c);var f=e({});h.poster&&s.attr("poster")&&(f=e("<div>").addClass("seeThru-poster").css({width:m.width+"px",height:m.height+"px",position:"absolute",top:0,left:0,"background-size":"cover","background-position":"center","background-image":'url("'+d.poster+'")'}),s.after(f)),c.add(f).on("mouseenter mouseleave click mousedown mouseup mousemove mouseover hover dblclick contextmenu focus blur",function(e){s.trigger(e)}),s.on("play.seeThru",function(){f.hide(),cancelAnimationFrame(p),p=requestAnimationFrame(function(){o(!0)}),s.data("seeThru").interval=p}).on("pause.seeThru",function(){cancelAnimationFrame(p),f.show()}),"autoplay"===h.start?s.trigger("play.seeThru"):"clicktoplay"===h.start?(d.play(),d.pause(),o(),c.one("click.seeThru",function(){d.play()})):"external"===h.start?(d.play(),d.pause(),o()):d.play(),"loop"===h.end?s.on("ended.seeThru",function(){s.one("pause",function(e){e.stopImmediatePropagation()}),d.play()}):"rewind"===h.end?s.on("ended.seeThru",function(){d.pause(),d.currentTime=0,"clicktoplay"==h.start&&c.one("click.seeThru",function(){d.play()})}):s.on("ended.seeThru",function(){d.pause(),"clicktoplay"==h.start&&c.one("click.seeThru",function(){d.play()})})}),this.videoWidth&&this.videoHeight&&e(this).trigger("loadedmetadata.seeThru")):e.error("Selected element must be <video> element")})},updateMask:function(a){var i=e.extend({mask:""},a);return this.each(function(){var a=e(this);if(e(i.mask).length){var h=a.data("seeThru").staticMask,n=a.data("seeThru").alphaMask;if(h)if("IMG"===e(i.mask)[0].tagName){var r={width:a.width(),height:a.height()},o=e(i.mask)[0];o.width=r.width,o.height=r.height;var s=a.nextAll(".seeThru-buffer")[0].getContext("2d");n?s.putImageData(t(r,o),0,r.height):s.drawImage(o,0,r.height,r.width,r.height)}else e.error("Passed mask element must be <img>");else e.error("Cannot apply method '.updateMask()' to element with moving alpha")}else e.error("Missing parameter 'mask'")})},revert:function(){return this.each(function(){var t=e(this);t.data("seeThru")&&(cancelAnimationFrame(t.data("seeThru").interval),t.show().unbind(".seeThru").removeData("seeThru").nextAll(".seeThru-buffer:first, .seeThru-display:first").remove())})},play:function(){return this.each(function(){e(this).data("seeThru")&&this.play()})},pause:function(){return this.each(function(){e(this).data("seeThru")&&this.pause()})},rewind:function(){return this.each(function(){e(this).data("seeThru")&&(this.pause(),this.currentTime=0)})}};e.fn.seeThru=function(t){return i[t]?i[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?(e.error("Method "+t+" does not exist on jQuery.seeThru"),undefined):i.init.apply(this,arguments)}})(jQuery);
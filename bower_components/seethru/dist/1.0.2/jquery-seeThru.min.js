/*! jQuery-seeThru 1.0.2 22-04-2014 see https://github.com/m90/jquery-seeThru for details */
(function(t){function e(e,a){var i=t("<canvas>").attr({width:e.width,height:e.height}).get(0).getContext("2d");i.drawImage(a,0,0,e.width,e.height);for(var h=i.getImageData(0,0,e.width,e.height),n=3,r=h.data.length;r>n;n+=4)h.data[n-1]=h.data[n-2]=h.data[n-3]=h.data[n],h.data[n]=255;return h}function a(t,e){for(var a=3,i=t.data.length;i>a;a+=4)t.data[a]=e[a-1],t.data[a-3]=t.data[a-3]/(e[a-1]?e[a-1]/255:1),t.data[a-2]=t.data[a-2]/(e[a-1]?e[a-1]/255:1),t.data[a-1]=t.data[a-1]/(e[a-1]?e[a-1]/255:1)}var i={init:function(i){i||(i={});var h=t.extend({start:"autoplay",end:"loop",mask:!1,alphaMask:!1,width:"",height:"",poster:!1,unmult:!1,shimRAF:!0},i);return h.shimRAF&&!window.requestAnimationFrame&&function(){for(var t=0,e=["ms","moz","webkit","o"],a=0;e.length>a&&!window.requestAnimationFrame;++a)window.requestAnimationFrame=window[e[a]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[a]+"CancelAnimationFrame"]||window[e[a]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var a=(new Date).getTime(),i=Math.max(0,16-(a-t)),h=window.setTimeout(function(){e(a+i)},i);return t=a+i,h}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}(),this.each(function(){if(t(this).data("seeThru"))throw Error("seeThru already initialized on selected element");var i,n=!1,r=h.alphaMask===!0;if(h.mask&&t(h.mask).length){if(i=t(h.mask)[0],"IMG"!==i.tagName)throw Error("Mask element must be <img>");t(i).hide(),n=!0}"VIDEO"===this.tagName?(t(this).on("loadedmetadata.seeThru",function(){function o(t){p.drawImage(d,0,0,m.width,m.height*u);var e=p.getImageData(0,0,m.width,m.height),i=p.getImageData(0,m.height,m.width,m.height).data;h.unmult&&a(e,i);for(var n=3,r=e.data.length;r>n;n+=4)e.data[n]=h.alphaMask?i[n-1]:Math.max(i[n-1],i[n-2],i[n-3]);w.putImageData(e,0,0,0,0,m.width,m.height),t&&(c=requestAnimationFrame(function(){o(!0)}),s.data("seeThru")&&(s.data("seeThru").interval=c))}var s=t(this),d=this,u=(t(window),n?1:2),m={width:parseInt(h.width,10),height:parseInt(h.height,10)};m.height&&m.width||(s.attr("width")||s.attr("height")?s.attr("height")?s.attr("width")?(m.width=m.width||parseInt(d.width,10),m.height=m.height||parseInt(d.height,10)/u):(m.width=m.width||parseInt(d.height,10)*(d.videoWidth/Math.floor(d.videoHeight/u)),m.height=m.height||parseInt(d.height,10)):(m.width=m.width||parseInt(d.width,10),m.height=m.height||parseInt(d.width,10)/(d.videoWidth/Math.floor(d.videoHeight/u))):(m.width=m.width||d.videoWidth,m.height=m.height||d.videoHeight/u));var c,g=t("<canvas>",{"class":"seeThru-buffer"}).attr({width:m.width,height:2*m.height}).hide(),l=t("<canvas>",{"class":"seeThru-display"}).attr({width:m.width,height:m.height}),w=l[0].getContext("2d"),p=g[0].getContext("2d");n&&(i.width=m.width,i.height=m.height,r?p.putImageData(e(m,i),0,m.height):p.drawImage(i,0,m.height,m.width,m.height)),"stop"===h.end&&d.loop&&(d.loop=!1),h.poster&&s.wrap(t("<div>").css({position:"relative",width:m.width+"px",height:m.height+"px"}).addClass("seeThru-container")),s.hide().data("seeThru",{staticMask:n,alphaMask:r,interval:c}).after(g,l);var f=t({});h.poster&&s.attr("poster")&&(f=t("<div>").addClass("seeThru-poster").css({width:m.width+"px",height:m.height+"px",position:"absolute",top:0,left:0,"background-size":"cover","background-position":"center","background-image":'url("'+d.poster+'")'}),s.after(f));var v=["mouseenter","mouseleave","click","mousedown","mouseup","mousemove","mouseover","hover","dblclick","contextmenu","focus","blur"];l.add(f).on(v.join(" "),function(t){s.trigger(t)}),s.on("play.seeThru",function(){f.hide(),cancelAnimationFrame(c),c=requestAnimationFrame(function(){o(!0)}),s.data("seeThru").interval=c}).on("pause.seeThru",function(){cancelAnimationFrame(c),f.show()}),"autoplay"===h.start?s.trigger("play.seeThru"):"clicktoplay"===h.start?(d.play(),d.pause(),o(),l.one("click.seeThru",function(){d.play()})):"external"===h.start?(d.play(),d.pause(),o()):d.play(),"loop"===h.end?s.on("ended.seeThru",function(){s.one("pause",function(t){t.stopImmediatePropagation()}),d.play()}):"rewind"===h.end?s.on("ended.seeThru",function(){d.pause(),d.currentTime=0,"clicktoplay"==h.start&&l.one("click.seeThru",function(){d.play()})}):s.on("ended.seeThru",function(){d.pause(),"clicktoplay"==h.start&&l.one("click.seeThru",function(){d.play()})})}),this.videoWidth&&this.videoHeight&&t(this).trigger("loadedmetadata.seeThru")):t.error("Selected element must be <video> element")})},updateMask:function(a){var i=t.extend({mask:""},a);return this.each(function(){var a=t(this);if(!t(i.mask).length)throw Error("Missing parameter 'mask'");var h=a.data("seeThru").staticMask,n=a.data("seeThru").alphaMask;if(!h)throw Error("Cannot apply method '.updateMask()' to element with moving alpha");if("IMG"!==t(i.mask)[0].tagName)throw Error("Passed mask element must be <img>");var r={width:a.width(),height:a.height()},o=t(i.mask)[0];o.width=r.width,o.height=r.height;var s=a.nextAll(".seeThru-buffer")[0].getContext("2d");n?s.putImageData(e(r,o),0,r.height):s.drawImage(o,0,r.height,r.width,r.height)})},revert:function(){return this.each(function(){var e=t(this);e.data("seeThru")&&(e.data("seeThru")&&"interval"in e.data("seeThru")&&cancelAnimationFrame(e.data("seeThru").interval),e.show().unbind(".seeThru").removeData("seeThru").nextAll(".seeThru-buffer:first, .seeThru-display:first").remove())})},play:function(){return this.each(function(){t(this).data("seeThru")&&this.play()})},pause:function(){return this.each(function(){t(this).data("seeThru")&&this.pause()})},rewind:function(){return this.each(function(){t(this).data("seeThru")&&(this.pause(),this.currentTime=0)})}};t.fn.seeThru=function(e){return i[e]?i[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?(t.error("Method "+e+" does not exist on jQuery.seeThru"),void 0):i.init.apply(this,arguments)}})(jQuery);